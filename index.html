<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å¼€å¿ƒæ¶ˆæ¶ˆä¹ Â· æ•°å­—ä¸­è‹±é…å¯¹ 4Ã—4ï¼ˆè“è‰²å¡é€šï¼‰</title>
  <style>
    :root{
      --bg1:#cfe7ff; --bg2:#a6d0ff; --panel:#ffffff; --line:#bcdcff;
      --card:#e9f3ff; --card2:#d9ecff; --text:#0f172a; --muted:#5b6b7a;
      --accent:#3b82f6; --good:#10b981; --bad:#ef4444;
      --frontPattern:#d2e9ff;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, PingFang SC, "Noto Sans CJK", "Helvetica Neue", Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 20% -20%, var(--bg1) 0%, transparent 60%),
        radial-gradient(1000px 800px at 120% 110%, var(--bg2) 0%, transparent 60%),
        linear-gradient(180deg, #b4ddff, #c7e6ff 40%, #e6f3ff);
      min-height:100vh;
    }
    .clouds{
      position:fixed; inset:0; pointer-events:none; opacity:.35; background:
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="600" height="200" viewBox="0 0 600 200"><g fill="%23ffffff"><ellipse cx="80" cy="80" rx="60" ry="28"/><ellipse cx="130" cy="85" rx="50" ry="22"/><ellipse cx="190" cy="80" rx="70" ry="30"/><ellipse cx="360" cy="60" rx="80" ry="30"/><ellipse cx="420" cy="65" rx="60" ry="24"/><ellipse cx="500" cy="60" rx="70" ry="28"/></g></svg>') repeat-x 0 0 / 600px 200px;
      animation: drift 60s linear infinite;
    }
    @keyframes drift { from{background-position-x:0;} to{background-position-x:-600px;} }

    .wrap{max-width:900px; margin:20px auto; padding:16px;}
    header{
      display:flex; flex-wrap:wrap; gap:12px; align-items:center; justify-content:space-between;
      background: var(--panel); border:3px solid var(--line); border-radius:20px; padding:12px 16px;
      box-shadow: 0 8px 0 #9dc5ff;
    }
    h1{margin:0; font-size:20px;}
    .subtitle{font-size:12px; color:var(--muted)}
    .btn{
      background:linear-gradient(180deg,#60a5fa,#3b82f6); color:#fff; border:0;
      padding:10px 14px; border-radius:14px; font-weight:800; cursor:pointer;
      box-shadow: 0 6px 0 #2e6dd6; transition: transform .05s ease;
    }
    .btn:active{ transform: translateY(2px); box-shadow: 0 4px 0 #2e6dd6; }
    .stats{display:flex; gap:14px; font-size:14px}
    .stats strong{font-weight:800}

    main{margin-top:16px; display:grid; grid-template-columns: 1fr 280px; gap:16px}
    .board{
      background: var(--panel); border:3px solid var(--line); border-radius:20px; padding:14px;
      box-shadow: 0 10px 0 #9dc5ff;
    }
    .grid{
      display:grid; gap:12px; grid-template-columns: repeat(4, 1fr);
    }
    .slot{height:130px;}

    /* å¡ç‰‡ä¸ç¿»è½¬ */
    .card{position:relative; perspective:1000px; height:100%;}
    .card > button{all:unset; cursor:pointer; position:absolute; inset:0}
    .inner{position:absolute; inset:0; transform-style:preserve-3d; transition:transform .36s ease;}
    .face{position:absolute; inset:0; border-radius:16px; display:grid; place-items:center; padding:10px; text-align:center; backface-visibility:hidden;}
    /* æ­£é¢ï¼šæ²¡æœ‰ä»»ä½•æ•°å­—æˆ–æ–‡å­—æç¤ºï¼Œåªç”¨å¡é€šå›¾æ¡ˆ */
    .front{
      background:
        radial-gradient(20px 12px at 20% 25%, #ffffff 0%, transparent 60%),
        radial-gradient(18px 10px at 70% 30%, #ffffff 0%, transparent 60%),
        radial-gradient(16px 10px at 50% 70%, #ffffff 0%, transparent 60%),
        linear-gradient(180deg, var(--card) 0%, var(--frontPattern) 100%);
      border:2.5px solid #bcdcff;
      box-shadow: 0 6px 0 #9ec4ff;
    }
    .back{
      background:var(--card2);
      border:2.5px solid #9fc7ff;
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.5);
      transform:rotateY(180deg)
    }
    .word{font-weight:900; font-size:30px}
    .sub{opacity:.8; font-size:12px}
    .flipped .inner{transform: rotateY(180deg)}
    .matched .back{outline:3px solid var(--good)}
    .wrong{animation:shake .25s ease}
    @keyframes shake{0%{transform:translateX(0)} 25%{transform:translateX(-4px)} 50%{transform:translateX(4px)} 75%{transform:translateX(-2px)} 100%{transform:translateX(0)}}

    /* å¼€å¿ƒæ¶ˆé™¤åŠ¨ç”» */
    .pop{animation:pop .35s ease forwards}
    @keyframes pop{
      0%{transform: scale(1); filter: drop-shadow(0 0 0 rgba(16,185,129,0));}
      50%{transform: scale(1.08); filter: drop-shadow(0 10px 12px rgba(16,185,129,.35));}
      100%{transform: scale(1); filter: drop-shadow(0 0 0 rgba(16,185,129,0));}
    }
    .sparkle::after{
      content:""; position:absolute; inset:-6px; border-radius:18px; pointer-events:none;
      background:
        radial-gradient(6px 6px at 20% 30%, rgba(255,255,255,.9), transparent 60%),
        radial-gradient(5px 5px at 70% 60%, rgba(255,255,255,.9), transparent 60%),
        radial-gradient(4px 4px at 40% 80%, rgba(255,255,255,.9), transparent 60%);
      animation: blink .6s ease forwards;
    }
    @keyframes blink{ from{opacity:0} to{opacity:1} }

    aside{
      background:var(--panel); border:3px solid var(--line); border-radius:20px; padding:14px;
      box-shadow: 0 10px 0 #9dc5ff; display:grid; gap:10px
    }
    .list{display:grid; gap:6px}
    .pill{
      display:flex; justify-content:space-between; gap:8px; background:#eef6ff; border:2px solid #cfe5ff; padding:8px 10px; border-radius:12px; font-size:12px; color:#1f2f46
    }
    .pill strong{color:#0f1f36}

    .modal{position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; padding:16px}
    .modal.show{display:flex}
    .dialog{background:white; border-radius:18px; padding:18px; width:min(420px,95vw); text-align:center; border:3px solid #bcdcff}
    .dialog h3{margin:6px 0 10px}
    .big{font-size:28px; font-weight:900}

    .errorbar{position:fixed; left:0; right:0; top:0; padding:8px 12px; background:#1e3a8a; color:#fff; display:none; z-index:50}
    .errorbar.show{display:block}

    @media (max-width: 820px){
      main{grid-template-columns: 1fr;}
      .grid{grid-template-columns: repeat(4, 1fr);}
      .slot{height:110px;}
    }
  </style>
</head>
<body>
  <div class="clouds"></div>
  <div class="wrap">
    <div id="err" class="errorbar"></div>
    <header>
      <div>
        <h1>ğŸ’™ å¼€å¿ƒæ¶ˆæ¶ˆä¹ Â· æ•°å­—ä¸­è‹±é…å¯¹ 4Ã—4</h1>
        <div class="subtitle">ä» 0â€“10 éšæœºæŠ½å– 8 ç»„ã€‚æ­£é¢æ— æç¤ºï¼Œç¿»å¼€æ‰æ˜¾ç¤ºã€‚é…å¯¹æˆåŠŸå¼€å¿ƒæ¶ˆé™¤ï¼Œä¸æˆåŠŸä¼šç¿»å›ã€‚</div>
      </div>
      <div style="display:flex; gap:8px; align-items:center">
        <button id="restart" class="btn">é‡æ–°å¼€å§‹</button>
      </div>
      <div class="stats" aria-live="polite">
        <div>æ­¥æ•°ï¼š<strong id="moves">0</strong></div>
        <div>å·²é…å¯¹ï¼š<strong id="pairs">0/8</strong></div>
        <div>ç”¨æ—¶ï¼š<strong id="time">00:00</strong></div>
      </div>
    </header>

    <main>
      <section class="board">
        <div id="grid" class="grid" aria-label="Cards Grid"></div>
      </section>
      <aside>
        <div style="font-weight:800">æœ¬å±€æ•°å­—</div>
        <div id="vlist" class="list"></div>
      </aside>
    </main>
  </div>

  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="title">
    <div class="dialog">
      <div class="big">ğŸ‰ å¤ªæ£’äº†ï¼</div>
      <h3 id="title">ä½ å®Œæˆäº†æ‰€æœ‰é…å¯¹ï¼</h3>
      <p>æ­¥æ•°ï¼š<span id="m_moves">0</span>ï¼Œç”¨æ—¶ï¼š<span id="m_time">00:00</span></p>
      <div style="display:flex; gap:8px; justify-content:center; margin-top:10px">
        <button id="again" class="btn">å†æ¥ä¸€å±€</button>
        <button id="close" class="btn" style="background:#e5e7eb; box-shadow:none">å…³é—­</button>
      </div>
    </div>
  </div>

  <script>
    // ===== è¯åº“ï¼ˆ0â€“10ï¼‰=====
    const BANK = [
      { n:0, zh:"é›¶", en:"zero" },
      { n:1, zh:"ä¸€", en:"one" },
      { n:2, zh:"äºŒ", en:"two" },
      { n:3, zh:"ä¸‰", en:"three" },
      { n:4, zh:"å››", en:"four" },
      { n:5, zh:"äº”", en:"five" },
      { n:6, zh:"å…­", en:"six" },
      { n:7, zh:"ä¸ƒ", en:"seven" },
      { n:8, zh:"å…«", en:"eight" },
      { n:9, zh:"ä¹", en:"nine" },
      { n:10, zh:"å", en:"ten" }
    ];
    const TOTAL_PAIRS = 8; // 16 å¼ å¡ = 8 å¯¹

    // ===== çŠ¶æ€ =====
    const state = {
      deck: [], // 16 å¼ 
      first: null,
      second: null,
      lock: false,
      moves: 0,
      matchedPairs: 0,
      startAt: 0,
      timerId: 0,
      audioCtx: null
    };

    const $grid = document.getElementById('grid');
    const $vlist = document.getElementById('vlist');
    const $moves = document.getElementById('moves');
    const $pairs = document.getElementById('pairs');
    const $time = document.getElementById('time');

    document.getElementById('restart').addEventListener('click', restart);
    document.getElementById('again').addEventListener('click', ()=>{ hideModal(); restart(); });
    document.getElementById('close').addEventListener('click', hideModal);

    // éŸ³æ•ˆï¼šä½¿ç”¨ Web Audio å³æ—¶åˆæˆï¼Œæ— éœ€å¤–éƒ¨æ–‡ä»¶
    function audioCtx(){
      if(!state.audioCtx){
        state.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      return state.audioCtx;
    }
    function tone(freq=880, dur=0.15, type='sine', gain=0.05){
      const ctx = audioCtx();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = type; o.frequency.value = freq;
      g.gain.setValueAtTime(gain, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + dur);
      o.connect(g); g.connect(ctx.destination);
      o.start(); o.stop(ctx.currentTime + dur);
    }
    function chordMatch(){
      // å°å’Œå¼¦ä¸Šæ‰¬
      tone(660, .10, 'sine', 0.05);
      setTimeout(()=>tone(880, .12, 'triangle', 0.05), 90);
      setTimeout(()=>tone(990, .14, 'sine', 0.05), 180);
    }
    function buzz(){
      tone(180, .08, 'square', 0.04);
      setTimeout(()=>tone(140, .10, 'square', 0.03), 70);
    }

    // å·¥å…·
    function shuffle(arr){
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]] = [arr[j],arr[i]];
      }
      return arr;
    }
    function sample8(){
      const idx = Array.from({length:11}, (_,i)=>i);
      shuffle(idx);
      return idx.slice(0,8); // 8 unique indices from 0..10
    }
    function formatTime(ms){
      const s = Math.floor(ms/1000); const m = Math.floor(s/60), r = s%60;
      return String(m).padStart(2,'0')+":"+String(r).padStart(2,'0');
    }
    function startTimer(){
      state.startAt = Date.now();
      stopTimer();
      state.timerId = setInterval(()=>{ $time.textContent = formatTime(Date.now() - state.startAt); }, 250);
    }
    function stopTimer(){ if(state.timerId) clearInterval(state.timerId); state.timerId = 0; }

    // æ„å»º 8 å¯¹ï¼ˆä» 0â€“10 éšæœºæŠ½ 8 ä¸ªï¼‰
    function buildPairs(){
      const ids = sample8();
      return ids.map(i=>BANK[i]);
    }

    // ç”Ÿæˆ 16 å¼ å¡ï¼ˆä¸­æ–‡ä¸è‹±æ–‡å„ä¸€å¼ ï¼‰
    function buildDeck(pairs){
      const deck = [];
      pairs.forEach((p, idx)=>{
        const key = String(p.n);
        deck.push({ id:`${idx}-zh`, key, lang:'zh', text:p.zh });
        deck.push({ id:`${idx}-en`, key, lang:'en', text:p.en });
      });
      return shuffle(deck);
    }

    function renderVocab(pairs){
      $vlist.innerHTML = '';
      pairs.forEach(p=>{
        const div = document.createElement('div');
        div.className = 'pill';
        div.innerHTML = `<span>#${p.n}</span><strong>${p.zh}</strong><span style="opacity:.6">â‡„</span><strong>${p.en}</strong>`;
        $vlist.appendChild(div);
      });
    }

    function renderGrid(){
      $grid.innerHTML = '';
      state.deck.forEach(card=>{
        const slot = document.createElement('div');
        slot.className = 'slot';
        slot.innerHTML = cardHTML(card);
        $grid.appendChild(slot);
      });
      $grid.querySelectorAll('.card').forEach(el=> el.addEventListener('click', onFlip));
    }

    function cardHTML(card){
      return `
        <div class="card" data-id="${card.id}" data-key="${card.key}" data-lang="${card.lang}">
          <button aria-label="card">
            <div class="inner">
              <div class="face front"></div>
              <div class="face back">
                <div class="word">${escapeHtml(card.text)}</div>
                <div class="sub">${card.lang==='zh'?'ä¸­æ–‡':'English'}</div>
              </div>
            </div>
          </button>
        </div>`;
    }

    function escapeHtml(s){
      return s.replace(/[&<>\"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));
    }

    function onFlip(e){
      if(state.lock) return;
      const card = e.currentTarget;
      if(card.classList.contains('matched') || card.classList.contains('flipped')) return;
      card.classList.add('flipped');

      if(!state.first){
        state.first = card;
        return;
      }
      state.second = card;
      state.lock = true;
      state.moves++; $moves.textContent = state.moves;

      const a = state.first, b = state.second;
      const isMatch = a.getAttribute('data-key') === b.getAttribute('data-key')
                      && a.getAttribute('data-lang') !== b.getAttribute('data-lang');

      if(isMatch){
        setTimeout(()=>{
          a.classList.add('matched','pop','sparkle'); b.classList.add('matched','pop','sparkle');
          chordMatch(); // å¼€å¿ƒéŸ³æ•ˆ
          state.first = null; state.second = null; state.lock = false;
          state.matchedPairs++; $pairs.textContent = state.matchedPairs + '/' + TOTAL_PAIRS;
          checkWin();
        }, 220);
      }else{
        setTimeout(()=>{
          a.classList.remove('flipped');
          b.classList.remove('flipped'); b.classList.add('wrong');
          buzz(); // è½»å¾®é”™è¯¯éŸ³æ•ˆ
          setTimeout(()=> b.classList.remove('wrong'), 260);
          state.first = null; state.second = null; state.lock = false;
        }, 800);
      }
    }

    function checkWin(){
      if(state.matchedPairs === TOTAL_PAIRS){
        stopTimer();
        document.getElementById('m_moves').textContent = state.moves;
        document.getElementById('m_time').textContent = $time.textContent;
        showModal();
      }
    }

    function showModal(){ document.getElementById('modal').classList.add('show'); }
    function hideModal(){ document.getElementById('modal').classList.remove('show'); }

    function restart(){
      const pairs = buildPairs();
      state.deck = buildDeck(pairs);
      state.first = null; state.second = null; state.lock=false; state.moves=0; state.matchedPairs=0;
      $moves.textContent = '0'; $pairs.textContent = '0/' + TOTAL_PAIRS; $time.textContent = '00:00';
      renderVocab(pairs);
      renderGrid();
      startTimer();
    }

    // å¯åŠ¨
    window.addEventListener('DOMContentLoaded', restart);
  </script>
</body>
</html>
